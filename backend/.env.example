# VVLIVE Backend Configuration
# Copy this file to .env and update with your actual values

# ============================================================================
# SERVER CONFIGURATION
# ============================================================================
# Host to bind the server to (0.0.0.0 for all interfaces, 127.0.0.1 for local only)
HOST=0.0.0.0
# Port for the FastAPI server
PORT=8000
# Enable debug mode (auto-reload, detailed errors)
DEBUG=false

# ============================================================================
# SECURITY
# ============================================================================
# CRITICAL: Change these in production!
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
SECRET_KEY=change-this-to-random-secure-key-in-production
API_TOKEN=change-this-to-random-secure-token-in-production

# ============================================================================
# ENCODER CONFIGURATION (URay or similar H.265 encoder)
# ============================================================================
# IP address of the video encoder
ENCODER_IP=192.168.1.100
# Encoder admin username
ENCODER_USERNAME=admin
# Encoder admin password
ENCODER_PASSWORD=change-encoder-password
# Encoder type (uray, teradek, etc.)
ENCODER_TYPE=uray

# ============================================================================
# OBS STUDIO WEBSOCKET
# ============================================================================
# OBS WebSocket server host
OBS_HOST=localhost
# OBS WebSocket server port (default: 4455)
OBS_PORT=4455
# OBS WebSocket password (leave empty if none set)
OBS_PASSWORD=

# ============================================================================
# MPTCP SERVER
# ============================================================================
# Port for MPTCP server to listen on
MPTCP_SERVER_PORT=8443

# ============================================================================
# MONITORING
# ============================================================================
# How often to poll metrics (seconds)
METRICS_POLL_INTERVAL=1
# Logging level (DEBUG, INFO, WARNING, ERROR, CRITICAL)
LOG_LEVEL=INFO

# ============================================================================
# DATABASE
# ============================================================================
# Path to SQLite database file
DATABASE_PATH=./data/streaming.db

# ============================================================================
# FEATURE FLAGS (Existing)
# ============================================================================
# Enable emergency mode (switch to simple scene on critical issues)
FEATURE_EMERGENCY_MODE=true
# Enable audio-only mode fallback
FEATURE_AUDIO_ONLY_MODE=true
# Detect when OBS output freezes
FEATURE_OUTPUT_FREEZE_DETECTION=true
# Detect when stream is live but muted
FEATURE_MUTED_BUT_LIVE_DETECTION=true
# Calculate and display health score
FEATURE_HEALTH_SCORE=true
# Score uplink reliability over time
FEATURE_UPLINK_TRUST_SCORING=true
# Suppress dead/unreliable links
FEATURE_DEAD_LINK_SUPPRESSION=true
# Silent alerts (notifications without audio)
FEATURE_SILENT_ALERTS=true
# Generate post-stream report
FEATURE_POST_STREAM_REPORT=true
# Show timeline of events
FEATURE_TIMELINE=true

# ============================================================================
# NOALBS-INSPIRED FEATURES (Opt-In - Default: Disabled)
# ============================================================================
# Enable OBS WebSocket integration for automatic scene switching
FEATURE_OBS_INTEGRATION=false
# Enable ingest server stats monitoring (nginx-rtmp, SRT, etc.)
FEATURE_INGEST_MONITORING=false
# Enable retry logic before state changes (prevents quality flapping)
FEATURE_RETRY_LOGIC=false
# Enable dual metrics monitoring (MPTCP + ingest stats combined)
FEATURE_DUAL_METRICS=false

# ============================================================================
# INGEST SERVER CONFIGURATION (NOALBS Pattern)
# ============================================================================
# Stats endpoint URL (nginx-rtmp example: http://localhost/stats)
INGEST_STATS_URL=http://localhost/stats
# Stream key to monitor (example: live/stream)
INGEST_STREAM_KEY=live/stream
# How often to poll stats endpoint (seconds)
INGEST_STATS_POLL_INTERVAL=2
# Server type: nginx, srt, node-media-server, srt-live-server
INGEST_SERVER_TYPE=nginx

# ============================================================================
# NOALBS-STYLE BITRATE THRESHOLDS
# ============================================================================
# Bitrate below this triggers LOW quality state (kbps)
BITRATE_THRESHOLD_LOW_KBPS=500
# Bitrate below this triggers OFFLINE state (kbps)
BITRATE_THRESHOLD_OFFLINE_KBPS=450
# RTT threshold for SRT protocol monitoring (milliseconds)
BITRATE_THRESHOLD_RTT_MS=1000

# ============================================================================
# RETRY LOGIC (Anti-Flapping Protection)
# ============================================================================
# Number of consecutive failing checks before changing state
STATE_CHANGE_RETRY_ATTEMPTS=5
# Seconds between retry checks
STATE_CHANGE_RETRY_INTERVAL=2
# Skip retries when recovering to higher quality (faster upgrade)
INSTANT_RECOVERY_ENABLED=true

# ============================================================================
# OBS SCENE MAPPING (Quality State â†’ Scene Name)
# ============================================================================
# Scene for HIGH quality state
OBS_SCENE_HIGH=Main Camera
# Scene for MEDIUM quality state
OBS_SCENE_MEDIUM=Main Camera
# Scene for LOW quality state
OBS_SCENE_LOW=Simple Overlay
# Scene for VERY_LOW quality state
OBS_SCENE_VERY_LOW=Audio Only
# Scene for ERROR state
OBS_SCENE_ERROR=Stream Offline
# Scene for EMERGENCY mode
OBS_SCENE_EMERGENCY=Emergency Simple
